name: "Tropico"
game_slug: tropico
version: "GOG w/ dxwrapper, editing tools"
slug: tropico-installer
runner: wine
script:
  files:
  - game: N/A:Select the Windows setup file downloaded from GOG
  - dxWrapper: https://github.com/elishacloud/dxwrapper/releases/download/v1.0.6542.21/dxwrapper.zip
  - tropicoEditor: https://github.com/alexanderjgray/myLutrisScripts/releases/download/v0.4-tropico/tedit.tar.gz
  - hotelFix: https://github.com/alexanderjgray/myLutrisScripts/releases/download/v0.4-tropico/FixHotel.tar.gz
  - autoHotelFix: https://github.com/alexanderjgray/myLutrisScripts/releases/download/v0.4-tropico/tropico-auto-hotel-fix.sh
  - autoScenarioFix: https://github.com/alexanderjgray/myLutrisScripts/releases/download/v0.4-tropico/tropico-auto-scenario-fix.sh
  game:
    gogid: 1207663953
    exe: $GAMEDIR/drive_c/GOG Games/Tropico/tropico.EXE
    prefix: $GAMEDIR
  installer:
  - task:
      args: /silent /nogui /suppressmsgboxes
      executable: game
      name: wineexec
      prefix: $GAMEDIR
  - extract:
      dst: $GAMEDIR/extras/dxwrapper
      file: $dxWrapper
  - copy:
      dst: $GAMEDIR/drive_c/GOG Games/Tropico
      src: $GAMEDIR/extras/dxwrapper/dxwrapper.dll
  - copy:
      dst: $GAMEDIR/drive_c/GOG Games/Tropico
      src: $GAMEDIR/extras/dxwrapper/dxwrapper.ini
  - copy:
      dst: $GAMEDIR/drive_c/GOG Games/Tropico
      src: $GAMEDIR/extras/dxwrapper/Stub/ddraw.dll
  - copy:
      dst: $GAMEDIR/extras
      src: $tropicoEditor
  - copy:
      dst: $GAMEDIR/extras
      src: $hotelFix
  - copy:
      dst: $GAMEDIR/extras
      src: $autoHotelFix
  - copy:
      dst: $GAMEDIR/extras
      src: $autoScenarioFix
  - write_config:
      file: $GAMEDIR/drive_c/GOG Games/Tropico/dxwrapper.ini
      key: Dd7to9
      section: Compatibility
      value: 1
  - write_config:
      file: $GAMEDIR/drive_c/GOG Games/Tropico/dxwrapper.ini
      key: DdrawFixByteAlignment
      section: ddraw
      value: 1
  - extract:
      dst: $GAMEDIR/drive_c/GOG Games/Tropico
      src: $GAMEDIR/extras/tedit.tar.gz
  - extract:
      dst: $GAMEDIR/extras/FixHotel
      src: $GAMEDIR/extras/FixHotel.tar.gz
  - chmodx: $GAMEDIR/extras/tropico-auto-hotel-fix.sh
  - chmodx: $GAMEDIR/extras/tropico-auto-scenario-fix.sh
  - execute:
      file: $GAMEDIR/extras/tropico-auto-scenario-fix.sh
  wine:
    overrides:
      ddraw.dll: n
